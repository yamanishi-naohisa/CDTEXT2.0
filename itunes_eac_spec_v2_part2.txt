# iTunesâ†’EAC CDæƒ…å ±è‡ªå‹•è»¢é€ã‚·ã‚¹ãƒ†ãƒ  è©³ç´°ä»•æ§˜æ›¸ (GUIç‰ˆ v2.0)

## ç¬¬2éƒ¨: é‚¦é¡Œæ¤œç´¢æ©Ÿèƒ½ãƒ»Web APIçµ±åˆãƒ»ä¿¡é ¼åº¦è©•ä¾¡

---

## 4. é‚¦é¡Œæ¤œç´¢æ©Ÿèƒ½ä»•æ§˜

### 4.1 æ¦‚è¦

ã‚¯ãƒ©ã‚·ãƒƒã‚¯CDç­‰ã§è‹±èªã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å–å¾—ã•ã‚ŒãŸå ´åˆã«ã€Webæ¤œç´¢ã«ã‚ˆã‚Šæ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ã‚’è‡ªå‹•å–å¾—ã™ã‚‹æ©Ÿèƒ½ã€‚

### 4.2 æ¤œç´¢ãƒ•ãƒ­ãƒ¼

```
[CDæƒ…å ±å–å¾—å®Œäº†]
    â†“
[è¨€èªåˆ¤å®š] â†’ è‹±èªã®ã¿? â†’ YES
    â†“                      â†“
   NO                  [é‚¦é¡Œæ¤œç´¢ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–]
    â†“                      â†“
[ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½]        [ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¯ãƒªãƒƒã‚¯]
                           â†“
                   [æ¤œç´¢ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º]
                           â†“
                   [æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ]
                           â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚
          [Wikipedia]      [MusicBrainz]
                â”‚                  â”‚
                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              [æ¤œç´¢çµæœçµ±åˆ]
                      â†“
              [ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°]
                      â†“
              [å€™è£œãƒªã‚¹ãƒˆè¡¨ç¤º]
                      â†“
          [ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãƒ»é¸æŠ]
                      â†“
              [CDæƒ…å ±ã«åæ˜ ]
                      â†“
          [CDPLAYER.INIç”Ÿæˆ]
```

### 4.3 æ¤œç´¢å¯¾è±¡ã®åˆ¤å®š

#### 4.3.1 è¨€èªè‡ªå‹•åˆ¤å®š

```python
def detect_language(text):
    """ãƒ†ã‚­ã‚¹ãƒˆè¨€èªã‚’åˆ¤å®š"""
    # æ—¥æœ¬èªæ–‡å­—ï¼ˆã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ï¼‰ã®å­˜åœ¨ç¢ºèª
    japanese_pattern = r'[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]'
    
    if re.search(japanese_pattern, text):
        return 'ja'
    else:
        return 'en'
```

**åˆ¤å®šåŸºæº–**:
- ã‚¢ãƒ«ãƒãƒ åã«æ—¥æœ¬èªãŒå«ã¾ã‚Œã‚‹ â†’ ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½
- å…¨ãƒˆãƒ©ãƒƒã‚¯ã«æ—¥æœ¬èªãªã— â†’ é‚¦é¡Œæ¤œç´¢æ¨å¥¨
- ä¸€éƒ¨ãƒˆãƒ©ãƒƒã‚¯ã®ã¿æ—¥æœ¬èª â†’ éƒ¨åˆ†æ¤œç´¢æ¨å¥¨

#### 4.3.2 æ¤œç´¢è¦å¦ã®è¡¨ç¤º

| çŠ¶æ…‹ | è¡¨ç¤º | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|------|------|-----------|
| å…¨ã¦è‹±èª | ğŸŒ[æ—¥æœ¬èªåŒ–æ¨å¥¨] | è‡ªå‹•ã§æ¤œç´¢ãƒœã‚¿ãƒ³å¼·èª¿ |
| ä¸€éƒ¨æ—¥æœ¬èª | ğŸŒ[ä¸€éƒ¨æ—¥æœ¬èªåŒ–] | ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤º |
| å…¨ã¦æ—¥æœ¬èª | âœ“ æ—¥æœ¬èª | æ¤œç´¢ãƒœã‚¿ãƒ³éè¡¨ç¤º |

---

## 5. Webæ¤œç´¢APIçµ±åˆ

### 5.1 Wikipediaæ—¥æœ¬èªç‰ˆAPI

#### 5.1.1 æ¥ç¶šä»•æ§˜

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://ja.wikipedia.org/w/api.php`

**ä½¿ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
- `action=query` - ãƒšãƒ¼ã‚¸æ¤œç´¢
- `action=parse` - ãƒšãƒ¼ã‚¸å†…å®¹å–å¾—

#### 5.1.2 æ¤œç´¢å®Ÿè£…ä¾‹

```python
import requests

def search_wikipedia_ja(artist, album):
    """Wikipediaæ—¥æœ¬èªç‰ˆã§ã‚¢ãƒ«ãƒãƒ æ¤œç´¢"""
    
    # æ¤œç´¢ã‚¯ã‚¨ãƒªä½œæˆ
    search_query = f"{artist} {album}"
    
    params = {
        'action': 'query',
        'format': 'json',
        'list': 'search',
        'srsearch': search_query,
        'srlimit': 5,
        'utf8': 1
    }
    
    try:
        response = requests.get(
            'https://ja.wikipedia.org/w/api.php',
            params=params,
            timeout=10
        )
        response.raise_for_status()
        data = response.json()
        
        results = []
        for item in data.get('query', {}).get('search', []):
            page_id = item['pageid']
            title = item['title']
            
            # ãƒšãƒ¼ã‚¸å†…å®¹ã‚’å–å¾—ã—ã¦ãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆæŠ½å‡º
            tracks = extract_tracklist_from_page(page_id)
            
            if tracks:
                results.append({
                    'source': 'Wikipedia',
                    'album_title': title,
                    'tracks': tracks,
                    'confidence': 'high',
                    'url': f"https://ja.wikipedia.org/?curid={page_id}"
                })
        
        return results
    
    except requests.exceptions.RequestException as e:
        logging.error(f"Wikipediaæ¤œç´¢ã‚¨ãƒ©ãƒ¼: {e}")
        return []
```

#### 5.1.3 ãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆæŠ½å‡º

```python
def extract_tracklist_from_page(page_id):
    """Wikipediaãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆæŠ½å‡º"""
    
    params = {
        'action': 'parse',
        'format': 'json',
        'pageid': page_id,
        'prop': 'text'
    }
    
    response = requests.get(
        'https://ja.wikipedia.org/w/api.php',
        params=params,
        timeout=10
    )
    
    html_content = response.json()['parse']['text']['*']
    soup = BeautifulSoup(html_content, 'html.parser')
    
    # ãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢
    # å…¸å‹çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³:
    # - <h2>åéŒ²æ›²</h2> ã®å¾Œã® <ol>
    # - class="tracklist" ã®ãƒ†ãƒ¼ãƒ–ãƒ«
    
    tracks = []
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³1: <ol>ãƒªã‚¹ãƒˆ
    tracklist_section = soup.find('span', id='åéŒ²æ›²')
    if tracklist_section:
        ol = tracklist_section.find_next('ol')
        if ol:
            for idx, li in enumerate(ol.find_all('li'), 1):
                track_text = li.get_text(strip=True)
                # "ã‚¿ã‚¤ãƒˆãƒ« (åŸé¡Œ: Original Title)" å½¢å¼ã‚’è§£æ
                tracks.append({
                    'number': idx,
                    'title_ja': parse_japanese_title(track_text),
                    'title_en': parse_english_title(track_text)
                })
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼
    table = soup.find('table', class_='tracklist')
    if table and not tracks:
        for row in table.find_all('tr')[1:]:  # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
            cols = row.find_all('td')
            if len(cols) >= 2:
                tracks.append({
                    'number': len(tracks) + 1,
                    'title_ja': cols[1].get_text(strip=True),
                    'title_en': cols[2].get_text(strip=True) if len(cols) > 2 else ''
                })
    
    return tracks

def parse_japanese_title(text):
    """æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡º"""
    # "ã‚¿ã‚¤ãƒˆãƒ« (åŸé¡Œ: ...)" ã¾ãŸã¯ "ã‚¿ã‚¤ãƒˆãƒ« - ..."å½¢å¼
    match = re.match(r'^([^\(ï¼ˆ-]+)', text)
    return match.group(1).strip() if match else text

def parse_english_title(text):
    """è‹±èªã‚¿ã‚¤ãƒˆãƒ«ï¼ˆåŸé¡Œï¼‰ã‚’æŠ½å‡º"""
    # "... (åŸé¡Œ: Original Title)" å½¢å¼
    match = re.search(r'\(åŸé¡Œ[ï¼š:]\s*([^\)ï¼‰]+)', text)
    return match.group(1).strip() if match else ''
```

### 5.2 MusicBrainz API

#### 5.2.1 æ¥ç¶šä»•æ§˜

**ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `musicbrainzngs`

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: https://musicbrainz.org/ws/2/

#### 5.2.2 æ¤œç´¢å®Ÿè£…ä¾‹

```python
import musicbrainzngs

# åˆæœŸåŒ–
musicbrainzngs.set_useragent(
    "iTunes-to-EAC",
    "2.0",
    "https://github.com/yourproject"
)

def search_musicbrainz(artist, album):
    """MusicBrainzã§ã‚¢ãƒ«ãƒãƒ æ¤œç´¢"""
    
    try:
        # ãƒªãƒªãƒ¼ã‚¹æ¤œç´¢
        result = musicbrainzngs.search_releases(
            artist=artist,
            release=album,
            limit=5
        )
        
        results = []
        
        for release in result['release-list']:
            release_id = release['id']
            
            # è©³ç´°æƒ…å ±å–å¾—ï¼ˆãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå«ã‚€ï¼‰
            release_detail = musicbrainzngs.get_release_by_id(
                release_id,
                includes=['recordings', 'artist-credits']
            )
            
            # æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ã®å­˜åœ¨ç¢ºèª
            medium_list = release_detail['release'].get('medium-list', [])
            
            tracks = []
            for medium in medium_list:
                for track in medium.get('track-list', []):
                    recording = track['recording']
                    
                    # åˆ¥åï¼ˆæ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã‚’æ¤œç´¢
                    aliases = recording.get('alias-list', [])
                    ja_title = None
                    
                    for alias in aliases:
                        if alias.get('locale') == 'ja':
                            ja_title = alias['name']
                            break
                    
                    tracks.append({
                        'number': int(track['position']),
                        'title_ja': ja_title,
                        'title_en': recording['title']
                    })
            
            if any(t['title_ja'] for t in tracks):
                results.append({
                    'source': 'MusicBrainz',
                    'album_title': release['title'],
                    'tracks': tracks,
                    'confidence': 'medium',
                    'mbid': release_id
                })
        
        return results
    
    except musicbrainzngs.WebServiceError as e:
        logging.error(f"MusicBrainzæ¤œç´¢ã‚¨ãƒ©ãƒ¼: {e}")
        return []
```

### 5.3 æ¤œç´¢çµæœçµ±åˆ

#### 5.3.1 ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```python
from difflib import SequenceMatcher

def match_tracks(original_tracks, search_results):
    """ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒˆãƒ©ãƒƒã‚¯ã¨æ¤œç´¢çµæœã‚’ãƒãƒƒãƒãƒ³ã‚°"""
    
    matched = []
    
    for orig_track in original_tracks:
        orig_title = orig_track.title.lower()
        best_match = None
        best_score = 0
        
        for result in search_results:
            for result_track in result['tracks']:
                # è‹±èªã‚¿ã‚¤ãƒˆãƒ«ã§é¡ä¼¼åº¦è¨ˆç®—
                result_title_en = result_track.get('title_en', '').lower()
                
                similarity = SequenceMatcher(
                    None,
                    orig_title,
                    result_title_en
                ).ratio()
                
                if similarity > best_score and similarity > 0.7:
                    best_score = similarity
                    best_match = {
                        'original': orig_track,
                        'matched': result_track,
                        'similarity': similarity,
                        'source': result['source'],
                        'confidence': result['confidence']
                    }
        
        matched.append(best_match)
    
    return matched
```

#### 5.3.2 å€™è£œã®å„ªå…ˆé †ä½ä»˜ã‘

**ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–**:

| è¦ç´  | é…ç‚¹ | è©³ç´° |
|------|------|------|
| æ–‡å­—åˆ—é¡ä¼¼åº¦ | 40ç‚¹ | 0.7ä»¥ä¸Šã§åŠ ç‚¹ |
| ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ä¸€è‡´ | 20ç‚¹ | é †åºãŒæ­£ã—ã„ |
| ã‚½ãƒ¼ã‚¹ä¿¡é ¼æ€§ | 20ç‚¹ | Wikipedia > MusicBrainz |
| ãƒˆãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå®Œå…¨æ€§ | 10ç‚¹ | å…¨ãƒˆãƒ©ãƒƒã‚¯é‚¦é¡Œã‚ã‚Š |
| ã‚¢ãƒ«ãƒãƒ åä¸€è‡´åº¦ | 10ç‚¹ | ã‚¢ãƒ«ãƒãƒ åã®é¡ä¼¼åº¦ |

```python
def calculate_confidence_score(match_result):
    """ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢è¨ˆç®—"""
    
    score = 0
    
    # æ–‡å­—åˆ—é¡ä¼¼åº¦ï¼ˆæœ€å¤§40ç‚¹ï¼‰
    score += match_result['similarity'] * 40
    
    # ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ä¸€è‡´ï¼ˆ20ç‚¹ï¼‰
    if match_result['original'].number == match_result['matched']['number']:
        score += 20
    
    # ã‚½ãƒ¼ã‚¹ä¿¡é ¼æ€§ï¼ˆ20ç‚¹ï¼‰
    if match_result['source'] == 'Wikipedia':
        score += 20
    elif match_result['source'] == 'MusicBrainz':
        score += 15
    
    # ãã®ä»–ã®è¦ç´ ...
    
    # 100ç‚¹æº€ç‚¹ã«æ­£è¦åŒ–
    return min(100, score)
```

---

## 6. ä¿¡é ¼åº¦è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 

### 6.1 ä¿¡é ¼åº¦ãƒ¬ãƒ™ãƒ«å®šç¾©

| ãƒ¬ãƒ™ãƒ« | ã‚¹ã‚³ã‚¢ | è¡¨ç¤º | æ„å‘³ |
|--------|--------|------|------|
| é«˜ | 80-100 | â˜…â˜…â˜… | Wikipediaå…¬å¼ãƒšãƒ¼ã‚¸ã€å®Œå…¨ä¸€è‡´ |
| ä¸­ | 60-79 | â˜…â˜… | MusicBrainzã€éƒ¨åˆ†ä¸€è‡´ |
| ä½ | 40-59 | â˜… | ä¸€èˆ¬æ¤œç´¢ã€ä¸å®Œå…¨ä¸€è‡´ |
| ä¸æ˜ | 0-39 | [?] | ä¿¡é ¼æ€§ä½ã€è¦ç¢ºèª |

### 6.2 è‡ªå‹•é©ç”¨ãƒ«ãƒ¼ãƒ«

**è¨­å®šå¯èƒ½ãªå‹•ä½œ**:

1. **è‡ªå‹•é©ç”¨ãƒ¢ãƒ¼ãƒ‰**:
   - ã‚¹ã‚³ã‚¢80ä»¥ä¸Š â†’ è‡ªå‹•é©ç”¨
   - ã‚¹ã‚³ã‚¢60-79 â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
   - ã‚¹ã‚³ã‚¢59ä»¥ä¸‹ â†’ é©ç”¨ã—ãªã„

2. **æ‰‹å‹•ç¢ºèªãƒ¢ãƒ¼ãƒ‰**ï¼ˆæ¨å¥¨ï¼‰:
   - å…¨ã¦ã®å€™è£œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠãƒ»æ‰¿èª

3. **ä¿å®ˆçš„ãƒ¢ãƒ¼ãƒ‰**:
   - ã‚¹ã‚³ã‚¢90ä»¥ä¸Šã®ã¿è‡ªå‹•é©ç”¨
   - ãã®ä»–ã¯å…¨ã¦æ‰‹å‹•ç¢ºèª

### 6.3 è­¦å‘Šè¡¨ç¤º

```python
def show_confidence_warning(track_matches):
    """ä½ä¿¡é ¼åº¦ãƒˆãƒ©ãƒƒã‚¯ã®è­¦å‘Š"""
    
    low_confidence_tracks = [
        m for m in track_matches
        if m and calculate_confidence_score(m) < 60
    ]
    
    if low_confidence_tracks:
        message = f"""
        ä»¥ä¸‹ã®ãƒˆãƒ©ãƒƒã‚¯ã¯ä¿¡é ¼åº¦ãŒä½ã„ãŸã‚ã€ç¢ºèªã‚’ãŠå‹§ã‚ã—ã¾ã™:
        
        {', '.join([str(t['original'].number) for t in low_confidence_tracks])}
        
        ã“ã‚Œã‚‰ã®ãƒˆãƒ©ãƒƒã‚¯ã‚’æ‰‹å‹•ã§ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ
        """
        
        response = messagebox.askyesno("ç¢ºèª", message)
        return response
    
    return True
```

---

## 7. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

### 7.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ§‹é€ 

```
cache/
â”œâ”€â”€ search_results/
â”‚   â”œâ”€â”€ <artist>_<album>_<hash>.json
â”‚   â””â”€â”€ ...
â””â”€â”€ cache_index.json
```

#### 7.1.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

```json
{
  "query": {
    "artist": "Queen",
    "album": "A Night at the Opera",
    "search_date": "2024-11-30T12:00:00"
  },
  "results": [
    {
      "source": "Wikipedia",
      "tracks": [
        {
          "number": 1,
          "title_ja": "ãƒœãƒ˜ãƒŸã‚¢ãƒ³ãƒ»ãƒ©ãƒ—ã‚½ãƒ‡ã‚£",
          "title_en": "Bohemian Rhapsody",
          "confidence_score": 95
        }
      ],
      "url": "https://ja.wikipedia.org/..."
    }
  ],
  "cache_version": "2.0"
}
```

### 7.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™

```python
import json
from datetime import datetime, timedelta
from pathlib import Path

class SearchCache:
    """æ¤œç´¢çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†"""
    
    def __init__(self, cache_dir='cache', expire_days=30):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)
        self.expire_days = expire_days
    
    def get_cache_key(self, artist, album):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ"""
        import hashlib
        key_str = f"{artist.lower()}_{album.lower()}"
        hash_str = hashlib.md5(key_str.encode()).hexdigest()[:8]
        return f"{artist}_{album}_{hash_str}.json"
    
    def get(self, artist, album):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—"""
        cache_file = self.cache_dir / 'search_results' / self.get_cache_key(artist, album)
        
        if not cache_file.exists():
            return None
        
        with open(cache_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
        search_date = datetime.fromisoformat(data['query']['search_date'])
        if datetime.now() - search_date > timedelta(days=self.expire_days):
            return None  # æœŸé™åˆ‡ã‚Œ
        
        return data['results']
    
    def set(self, artist, album, results):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜"""
        cache_file = self.cache_dir / 'search_results' / self.get_cache_key(artist, album)
        cache_file.parent.mkdir(exist_ok=True)
        
        data = {
            'query': {
                'artist': artist,
                'album': album,
                'search_date': datetime.now().isoformat()
            },
            'results': results,
            'cache_version': '2.0'
        }
        
        with open(cache_file, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    
    def clear_all(self):
        """å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤"""
        import shutil
        shutil.rmtree(self.cache_dir / 'search_results', ignore_errors=True)
    
    def get_cache_size(self):
        """ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºå–å¾—ï¼ˆMBï¼‰"""
        total_size = 0
        for file in (self.cache_dir / 'search_results').glob('*.json'):
            total_size += file.stat().st_size
        return total_size / (1024 * 1024)  # MBå˜ä½
```

### 7.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚‚ã®**:
- âœ“ Wikipediaæ¤œç´¢çµæœ
- âœ“ MusicBrainzæ¤œç´¢çµæœ
- âœ“ ãƒãƒƒãƒãƒ³ã‚°çµæœ
- âœ— ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†å†…å®¹ï¼ˆå±¥æ­´ã¨ã—ã¦åˆ¥ç®¡ç†ï¼‰

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ¡ä»¶**:
- æ‰‹å‹•ã‚¯ãƒªã‚¢
- 30æ—¥é–“æœªä½¿ç”¨
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºãŒ100MBã‚’è¶…ãˆãŸå ´åˆ

---

## 8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆæ¤œç´¢æ©Ÿèƒ½ï¼‰

### 8.1 æ¤œç´¢ã‚¨ãƒ©ãƒ¼åˆ†é¡

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦ |
|--------|------|------|
| E101 | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœªæ¥ç¶š | ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§é€šçŸ¥ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶š |
| E102 | APIæ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ãƒªãƒˆãƒ©ã‚¤ææ¡ˆ |
| E103 | æ¤œç´¢çµæœ0ä»¶ | æ‰‹å‹•æ¤œç´¢æ¡ˆå†… |
| E104 | ãƒ‘ãƒ¼ã‚¹å¤±æ•— | ãƒ­ã‚°è¨˜éŒ²ã€ã‚¹ã‚­ãƒƒãƒ— |
| E105 | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | å¾…æ©Ÿå¾Œãƒªãƒˆãƒ©ã‚¤ |

### 8.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

```python
class SearchError(Exception):
    """æ¤œç´¢ã‚¨ãƒ©ãƒ¼åŸºåº•ã‚¯ãƒ©ã‚¹"""
    pass

class NetworkError(SearchError):
    """ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼"""
    pass

class NoResultsError(SearchError):
    """æ¤œç´¢çµæœãªã—"""
    pass

def safe_search_wikipedia(artist, album):
    """ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãWikipediaæ¤œç´¢"""
    
    try:
        # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç¢ºèª
        if not check_internet_connection():
            raise NetworkError("ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒã‚ã‚Šã¾ã›ã‚“")
        
        results = search_wikipedia_ja(artist, album)
        
        if not results:
            raise NoResultsError(f"ã€Œ{artist} - {album}ã€ã®æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
        
        return results
    
    except requests.exceptions.Timeout:
        logging.error("Wikipediaæ¤œç´¢ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ")
        return []
    
    except NetworkError as e:
        messagebox.showwarning("ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼", str(e))
        return []
    
    except NoResultsError as e:
        logging.info(str(e))
        return []
    
    except Exception as e:
        logging.error(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")
        return []

def check_internet_connection():
    """ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šç¢ºèª"""
    try:
        requests.get('https://www.google.com', timeout=3)
        return True
    except:
        return False
```

---

**ç¬¬2éƒ¨å®Œäº†ã€‚æ¬¡ã®ãƒ‘ãƒ¼ãƒˆï¼ˆç¬¬3éƒ¨: æ“ä½œæ‰‹é †ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™ãŒã§ããŸã‚‰ã€Œæ¬¡ã€ã¨ãŠä¼ãˆãã ã•ã„ã€‚**