# iTunes→EAC CD情報自動転送システム 詳細仕様書 (GUI版 v2.0)

## 第1部: システム概要・技術仕様・GUI設計

---

## 1. システム概要

### 1.1 目的
iTunesで取得したCD情報（トラック名、アーティスト、アルバム名等）をEAC（Exact Audio Copy）で利用可能な形式に変換し、リッピング作業を効率化する。GUI提供により直感的な操作を実現。

**v2.0新機能**: クラシックCDなど英語タイトルのみの場合、Web検索により日本語タイトルを自動取得・適用可能。

### 1.2 システム構成

- **入力**: iTunes COM APIから取得したCD情報
- **処理**: 
  - Python スクリプトによるデータ変換・ファイル生成
  - Web検索による邦題取得（Wikipedia、MusicBrainz等）
  - 手動編集・確認機能
- **出力**: CDPLAYER.INI ファイル
- **UI**: tkinter によるグラフィカルユーザーインターフェース
- **連携**: GUI上でiTunes/EACの起動・終了・状態確認を一元管理

### 1.3 v2.0 主要追加機能

1. **Web検索による邦題取得**
   - Wikipedia日本語版API
   - MusicBrainz API
   - 自動検索・マッチング

2. **タイトル編集機能**
   - トラックごとの手動編集
   - 一括置換
   - 検索結果から選択適用

3. **信頼度表示**
   - 自動取得した邦題の信頼度スコア
   - 複数候補の表示・選択

---

## 2. 技術仕様

### 2.1 開発環境

**言語**: Python 3.8以上

**必要ライブラリ**:
- `tkinter` - GUI（Python標準ライブラリ）
- `pywin32` (win32com.client) - iTunes COM API制御
- `subprocess` - プロセス起動・終了制御
- `pathlib` - ファイルパス操作
- `threading` - 非同期処理（GUIフリーズ防止）
- `configparser` - INIファイル操作
- `json` - ログ・履歴保存
- **`requests`** - Web API呼び出し（新規）
- **`beautifulsoup4`** - HTML解析（新規）
- **`musicbrainzngs`** - MusicBrainz API（新規）

### 2.2 対応環境

- **OS**: Windows 10/11
- **iTunes**: Windows版 (Microsoft Store版は未対応の可能性あり)
- **EAC**: バージョン1.0以降
- **画面解像度**: 最小 1024x768 推奨
- **インターネット接続**: 邦題検索機能使用時必須

### 2.3 ファイル構成

```
project/
├── itunes_to_eac_gui.py      # GUIメインスクリプト
├── itunes_controller.py       # iTunes制御モジュール
├── eac_controller.py          # EAC制御モジュール
├── cdplayer_generator.py      # CDPLAYER.INI生成モジュール
├── title_translator.py        # 邦題検索モジュール（新規）
├── web_search_manager.py      # Web検索統合管理（新規）
├── config.ini                 # 設定ファイル
├── README.md                  # 使用説明書
├── icon.ico                   # アプリケーションアイコン（オプション）
├── logs/                      # ログ出力ディレクトリ
├── history/                   # CD処理履歴ディレクトリ
└── cache/                     # 検索キャッシュ（新規）
```

---

## 3. GUI仕様

### 3.1 ウィンドウ構成

#### 3.1.1 メインウィンドウ（v2.0拡張版）

- **ウィンドウサイズ**: 900x700 (リサイズ可能)
- **タイトル**: "iTunes → EAC CD情報転送ツール v2.0"
- **レイアウト**: 4ペイン構成

```
┌──────────────────────────────────────────────────────────┐
│ iTunes → EAC CD情報転送ツール v2.0          [_][□][X]   │
├──────────────────────────────────────────────────────────┤
│ [メニューバー]                                            │
├──────────────────────────────────────────────────────────┤
│                                                           │
│  ┌─ アプリケーション制御 ─────────────────────┐        │
│  │ iTunes: [●起動中] [起動] [終了]              │        │
│  │ EAC:    [○未起動] [起動] [終了]              │        │
│  └───────────────────────────────────────────┘        │
│                                                           │
│  ┌─ CD情報 ─────────────────────────────────┐        │
│  │ 状態: [✓ 情報取得完了]                       │        │
│  │                                              │        │
│  │ アーティスト: [Queen]                        │        │
│  │ アルバム:     [A Night at the Opera]        │        │
│  │ トラック数:   [12]  言語: [英語] [日本語化] │        │
│  │                                              │        │
│  │ ┌─ トラックリスト ───────────────┐         │        │
│  │ │ #  原題                   邦題       信頼度│         │
│  │ ├──────────────────────────────┤         │        │
│  │ │ 01 Bohemian Rhapsody    ボヘミアン... ★★★│         │
│  │ │ 02 Death On Two Legs    [未取得]         │         │
│  │ │ 03 Lazing On A Sunday... 怠惰な日曜... ★★ │         │
│  │ │                        [編集] [検索]     │         │
│  │ └──────────────────────────────┘         │        │
│  └───────────────────────────────────────────┘        │
│                                                           │
│  ┌─ 操作 ──────────────────────────────────┐        │
│  │ [1. iTunesでCD情報取得]                     │        │
│  │ [1-B. 日本語タイトル検索] 🌐               │        │
│  │ [2. CDPLAYER.INI生成]                       │        │
│  │ [3. EACで読み込み]                          │        │
│  │                                              │        │
│  │ [■■■■■■□□□□] 処理中 (60%)            │        │
│  └───────────────────────────────────────────┘        │
│                                                           │
│  ┌─ ログ/ステータス ──────────────────────┐        │
│  │ [INFO] iTunes起動完了                        │        │
│  │ [SUCCESS] CD情報取得完了                     │        │
│  │ [INFO] Wikipedia検索中: "Queen A Night..."  │        │
│  │ [SUCCESS] 邦題3件取得完了                    │        │
│  └───────────────────────────────────────────┘        │
│                                                           │
└──────────────────────────────────────────────────────────┘
```

#### 3.1.2 メニューバー（v2.0拡張）

**ファイル (F)**
- 設定 (S) - 設定ダイアログを開く
- 履歴表示 (H) - CD処理履歴ウィンドウを開く
- **検索キャッシュをクリア** - 保存された検索結果を削除（新規）
- 終了 (X) - アプリケーション終了

**編集 (E)** ← 新規メニュー
- トラック情報を編集 (E) - 選択トラックの編集ダイアログ
- すべて原題に戻す (R) - 邦題をクリア
- 一括置換 (B) - 複数トラックの一括編集

**ツール (T)**
- CDPLAYER.INIを開く - エクスプローラーで表示
- ログフォルダを開く - ログディレクトリを表示
- 手動更新 (R) - CD情報を手動で再取得
- **検索エンジン設定** - Wikipedia/MusicBrainz優先度設定（新規）

**ヘルプ (H)**
- 使い方 (U) - 使用方法ダイアログ
- **邦題検索について** - Web検索機能の説明（新規）
- バージョン情報 (A) - バージョン・ライセンス情報

### 3.2 GUI要素詳細

#### 3.2.1 CD情報表示パネル（v2.0拡張）

**新規要素**:

**言語インジケータ**:
- [英語] - 英語タイトルのみ（グレー）
- [英語/日本語] - 一部邦題あり（オレンジ）
- [日本語] - 全て邦題取得済み（緑）

**[日本語化]ボタン**:
- クリックで全トラックの邦題を一括検索
- 処理中はプログレスバー表示

**トラックリスト（拡張版）**:
- **3カラム表示**: トラック番号 | 原題 | 邦題 | 信頼度
- **信頼度アイコン**:
  - ★★★ - 高信頼度（Wikipedia公式ページ）
  - ★★ - 中信頼度（MusicBrainz）
  - ★ - 低信頼度（一般検索）
  - [未取得] - 邦題なし
- **右クリックメニュー**:
  - このトラックを編集
  - Web検索
  - 原題に戻す
  - クリップボードにコピー

**各行の操作ボタン**:
- [編集] - 個別トラックの編集ダイアログ
- [検索] - そのトラックのみWeb検索

#### 3.2.2 操作パネル（v2.0拡張）

**ステップ1-B（新規）**:
- **[1-B. 日本語タイトル検索]** 🌐
- ステップ1完了後に有効化
- クリックで邦題検索ダイアログを開く
- スキップ可能（オプション機能）

### 3.3 新規ダイアログ仕様

#### 3.3.1 邦題検索ダイアログ

```
┌──────────────────────────────────────────────┐
│ 日本語タイトル検索                  [_][□][X]│
├──────────────────────────────────────────────┤
│                                               │
│ アルバム: A Night at the Opera                │
│ アーティスト: Queen                           │
│                                               │
│ [検索オプション]                              │
│ ☑ Wikipedia日本語版                          │
│ ☑ MusicBrainz                                │
│ ☐ 一般Web検索（精度低）                      │
│                                               │
│ 検索範囲:                                     │
│ ○ 全トラック                                 │
│ ○ 未取得トラックのみ                         │
│ ○ 選択トラック (2件)                         │
│                                               │
│ [■■■□□□□□□□] 検索中... (3/12)         │
│                                               │
│ ┌─ 検索結果プレビュー ──────────────┐      │
│ │ 01. Bohemian Rhapsody → ボヘミアン... │      │
│ │ 03. Lazing On... → 怠惰な日曜の午後   │      │
│ │ 05. I'm In Love... → [候補2件]       │      │
│ └──────────────────────────────┘      │
│                                               │
│     [検索開始]  [適用]  [キャンセル]         │
└──────────────────────────────────────────────┘
```

#### 3.3.2 トラック編集ダイアログ

```
┌──────────────────────────────────────┐
│ トラック情報編集            [_][X]   │
├──────────────────────────────────────┤
│                                       │
│ トラック: 01                          │
│                                       │
│ 原題:                                 │
│ [Bohemian Rhapsody               ]   │
│                                       │
│ 邦題:                                 │
│ [ボヘミアン・ラプソディ         ]   │
│                                       │
│ アーティスト:                         │
│ [Queen                           ]   │
│                                       │
│ ┌─ Web検索候補 ───────────┐        │
│ │ ○ ボヘミアン・ラプソディ (Wiki)│        │
│ │ ○ ボヘミアンラプソディー (MB)  │        │
│ │ ○ Bohemian Rhapsody (原題)    │        │
│ └───────────────────────┘        │
│                                       │
│ [Web検索]  [OK]  [キャンセル]        │
└──────────────────────────────────────┘
```

#### 3.3.3 検索設定ダイアログ（新規）

```
┌─────────────────────────────────────┐
│ 検索エンジン設定           [_][X]   │
├─────────────────────────────────────┤
│                                      │
│ [優先順位]                           │
│  1. [Wikipedia日本語版    ▲▼]      │
│  2. [MusicBrainz          ▲▼]      │
│  3. [一般Web検索          ▲▼]      │
│                                      │
│ [検索パラメータ]                     │
│  タイムアウト: [30] 秒              │
│  最大候補数:   [5]                  │
│                                      │
│ [キャッシュ]                         │
│  ☑ 検索結果をキャッシュ             │
│  有効期限: [30] 日                  │
│  使用容量: 2.4 MB / 100 MB          │
│  [キャッシュをクリア]               │
│                                      │
│ [その他]                             │
│  ☑ 信頼度が低い場合は警告           │
│  ☐ 自動で最高信頼度を適用           │
│                                      │
│        [OK]  [キャンセル]  [適用]   │
└─────────────────────────────────────┘
```

### 3.4 キーボードショートカット（v2.0拡張）

| キー | 動作 |
|------|------|
| Ctrl+1 | ステップ1実行 |
| **Ctrl+Shift+1** | **ステップ1-B実行（邦題検索）** |
| Ctrl+2 | ステップ2実行 |
| Ctrl+3 | ステップ3実行 |
| Ctrl+A | 一括実行 |
| Ctrl+R | リセット |
| **Ctrl+E** | **選択トラックを編集** |
| **Ctrl+F** | **Web検索** |
| Ctrl+S | 設定ダイアログ |
| Ctrl+H | 履歴表示 |
| Ctrl+Q | 終了 |
| F1 | ヘルプ |
| F5 | 手動更新 |

---

**第1部完了。次のパート（第2部: 機能仕様・邦題検索詳細）をダウンロードする準備ができたら「次」とお伝えください。**